<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Africa CDC Public Dashboards</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Styles to hide unnecessary elements inside the iframe */
        div.jsx-55705730 {
            display: none !important;
        }

        div.jsx-2727136053 {
            display: none !important;
        }

        .headerbar-profile.jsx-3442481507 {
            display: none !important;
        }

        /* Circular Preloader Styles (Smaller and Centered) */
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loader-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        /* Iframe container to ensure proper loading */
        .iframe-container {
            position: relative;
            display: none;
            /* Hidden until loaded */
        }

        .iframe-loaded {
            display: block;
            /* Show iframe once loaded */
        }

        /* General Body Style */
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- Error Message -->
        <div v-if="errorMessage">
            <p style="color: red;">{{ errorMessage }}</p>
        </div>

        <!-- Loader while iframe is loading -->
        <div v-if="loading" class="loader-container">
            <div class="loader"></div>
        </div>

        <!-- Iframe that loads after preloader -->
        <div class="iframe-container" v-if="dashboardLoaded">
            <iframe id="dashboardIframe" :src="dashboardUrl" width="100%" height="600px" frameborder="0" allowfullscreen
                @load="iframeLoaded"></iframe>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                loading: true,
                errorMessage: '',
                dashboardUrl: '',
                dashboardLoaded: false
            },
            mounted() {
                this.autoLogin();
            },
            methods: {
                async autoLogin() {
                    try {
                        const baseUrl = window.location.origin;
                        console.log("Base URL is: " + baseUrl);

                        let baseUrlF; // Declare variable

                        // Check if the base URL contains 'localhost' or '127.0.0.1'
                        if (baseUrl.includes('localhost') || baseUrl.includes('127.0.0.1')) {
                            baseUrlF = baseUrl + ':3000'; // Concatenate port 3000 for localhost
                        } else {
                            baseUrlF = baseUrl; // Keep the remote server URL unchanged
                        }

                        console.log("Final Base URL is: " + baseUrlF);
                        const response = await axios.post(baseUrlF + '/node_app/login/', {}, {
                            withCredentials: true // Essential for including cookies in the request
                        });

                        if (response.status === 200 && response.data.message === 'Login successful') {
                            this.dashboardUrl = response.data.dashboardUrl;
                            this.loading = false; // Stop showing the loader
                            this.dashboardLoaded = true; // Start showing the iframe
                        } else {
                            this.loading = false;
                            this.errorMessage = 'Failed to load dashboard: ' + (response.data.message || 'No message');
                        }
                    } catch (error) {
                        this.loading = false;
                        this.errorMessage = 'Login failed: ' + (error.response?.data?.message || 'Unknown error');
                    }
                },
                iframeLoaded() {
                    // Called when the iframe is fully loaded
                    const iframeContainer = document.querySelector('.iframe-container');
                    iframeContainer.classList.add('iframe-loaded'); // Add class to show the iframe
                    this.loading = false; // Hide the loader

                    // Inject styles into the iframe (only works if iframe is same-origin)
                    const iframe = document.getElementById('dashboardIframe');
                    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;

                    const styleElement = iframeDocument.createElement('style');
                    styleElement.type = 'text/css';
                    styleElement.appendChild(document.createTextNode(`
                        div.jsx-55705730 {
                            display: none !important;
                        }
                        div.jsx-2727136053 {
                            display: none !important;
                        }
                        .headerbar-profile.jsx-3442481507 {
                            display: none !important;
                        }
                        .DashboardsBar_bar__0l1F7 {
                            display.none !important;
                        }
                    `));
                    iframeDocument.head.appendChild(styleElement);
                }
            }
        });
    </script>
</body>

</html>